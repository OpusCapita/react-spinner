var __assign = this && this.__assign || Object.assign || function (t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) {
            if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
    }
    return t;
};
var defaults = {
    lines: 12,
    length: 7,
    width: 5,
    radius: 10,
    scale: 1.0,
    corners: 1,
    color: '#000',
    fadeColor: 'transparent',
    animation: 'spinner-line-fade-default',
    rotate: 0,
    direction: 1,
    speed: 1,
    zIndex: 2e9,
    className: 'spinner',
    top: '50%',
    left: '50%',
    shadow: '0 0 1px transparent',
    position: 'absolute'
};
var Spinner = /** @class */function () {
    function Spinner(opts) {
        if (opts === void 0) {
            opts = {};
        }
        this.opts = __assign({}, defaults, opts);
    }
    /**
     * Adds the spinner to the given target element. If this instance is already
     * spinning, it is automatically removed from its previous target by calling
     * stop() internally.
     */
    Spinner.prototype.spin = function (target) {
        this.stop();
        this.el = document.createElement('div');
        this.el.className = this.opts.className;
        this.el.setAttribute('role', 'progressbar');
        css(this.el, {
            position: this.opts.position,
            width: 0,
            zIndex: this.opts.zIndex,
            left: this.opts.left,
            top: this.opts.top,
            transform: "scale(" + this.opts.scale + ")"
        });
        if (target) {
            target.insertBefore(this.el, target.firstChild || null);
        }
        drawLines(this.el, this.opts);
        return this;
    };
    /**
     * Stops and removes the Spinner.
     * Stopped spinners may be reused by calling spin() again.
     */
    Spinner.prototype.stop = function () {
        if (this.el) {
            if (typeof requestAnimationFrame !== 'undefined') {
                cancelAnimationFrame(this.animateId);
            } else {
                clearTimeout(this.animateId);
            }
            if (this.el.parentNode) {
                this.el.parentNode.removeChild(this.el);
            }
            this.el = undefined;
        }
        return this;
    };
    return Spinner;
}();
export { Spinner };
/**
 * Sets multiple style properties at once.
 */
function css(el, props) {
    for (var prop in props) {
        el.style[prop] = props[prop];
    }
    return el;
}
/**
 * Returns the line color from the given string or array.
 */
function getColor(color, idx) {
    return typeof color == 'string' ? color : color[idx % color.length];
}
/**
 * Internal method that draws the individual lines.
 */
function drawLines(el, opts) {
    var borderRadius = Math.round(opts.corners * opts.width * 500) / 1000 + 'px';
    var shadow = 'none';
    if (opts.shadow === true) {
        shadow = '0 2px 4px #000'; // default shadow
    } else if (typeof opts.shadow === 'string') {
        shadow = opts.shadow;
    }
    var shadows = parseBoxShadow(shadow);
    for (var i = 0; i < opts.lines; i++) {
        var degrees = ~~(360 / opts.lines * i + opts.rotate);
        var backgroundLine = css(document.createElement('div'), {
            position: 'absolute',
            top: -opts.width / 2 + "px",
            width: opts.length + opts.width + 'px',
            height: opts.width + 'px',
            background: getColor(opts.fadeColor, i),
            borderRadius: borderRadius,
            transformOrigin: 'left',
            transform: "rotate(" + degrees + "deg) translateX(" + opts.radius + "px)"
        });
        var delay = i * opts.direction / opts.lines / opts.speed;
        delay -= 1 / opts.speed; // so initial animation state will include trail
        var line = css(document.createElement('div'), {
            width: '100%',
            height: '100%',
            background: getColor(opts.color, i),
            borderRadius: borderRadius,
            boxShadow: normalizeShadow(shadows, degrees),
            animation: 1 / opts.speed + "s linear " + delay + "s infinite " + opts.animation
        });
        backgroundLine.appendChild(line);
        el.appendChild(backgroundLine);
    }
}
function parseBoxShadow(boxShadow) {
    var regex = /^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/;
    var shadows = [];
    for (var _i = 0, _a = boxShadow.split(','); _i < _a.length; _i++) {
        var shadow = _a[_i];
        var matches = shadow.match(regex);
        if (matches === null) {
            continue; // invalid syntax
        }
        var x = +matches[2];
        var y = +matches[5];
        var xUnits = matches[4];
        var yUnits = matches[7];
        if (x === 0 && !xUnits) {
            xUnits = yUnits;
        }
        if (y === 0 && !yUnits) {
            yUnits = xUnits;
        }
        if (xUnits !== yUnits) {
            continue; // units must match to use as coordinates
        }
        shadows.push({
            prefix: matches[1] || '',
            x: x,
            y: y,
            xUnits: xUnits,
            yUnits: yUnits,
            end: matches[8]
        });
    }
    return shadows;
}
/**
 * Modify box-shadow x/y offsets to counteract rotation
 */
function normalizeShadow(shadows, degrees) {
    var normalized = [];
    for (var _i = 0, shadows_1 = shadows; _i < shadows_1.length; _i++) {
        var shadow = shadows_1[_i];
        var xy = convertOffset(shadow.x, shadow.y, degrees);
        normalized.push(shadow.prefix + xy[0] + shadow.xUnits + ' ' + xy[1] + shadow.yUnits + shadow.end);
    }
    return normalized.join(', ');
}
function convertOffset(x, y, degrees) {
    var radians = degrees * Math.PI / 180;
    var sin = Math.sin(radians);
    var cos = Math.cos(radians);
    return [Math.round((x * cos + y * sin) * 1000) / 1000, Math.round((-x * sin + y * cos) * 1000) / 1000];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zcGluLmpzL3NwaW4uanMiXSwibmFtZXMiOlsiX19hc3NpZ24iLCJPYmplY3QiLCJhc3NpZ24iLCJ0IiwicyIsImkiLCJuIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwicCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlZmF1bHRzIiwibGluZXMiLCJ3aWR0aCIsInJhZGl1cyIsInNjYWxlIiwiY29ybmVycyIsImNvbG9yIiwiZmFkZUNvbG9yIiwiYW5pbWF0aW9uIiwicm90YXRlIiwiZGlyZWN0aW9uIiwic3BlZWQiLCJ6SW5kZXgiLCJjbGFzc05hbWUiLCJ0b3AiLCJsZWZ0Iiwic2hhZG93IiwicG9zaXRpb24iLCJTcGlubmVyIiwib3B0cyIsInNwaW4iLCJ0YXJnZXQiLCJzdG9wIiwiZWwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJjc3MiLCJ0cmFuc2Zvcm0iLCJpbnNlcnRCZWZvcmUiLCJmaXJzdENoaWxkIiwiZHJhd0xpbmVzIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY2FuY2VsQW5pbWF0aW9uRnJhbWUiLCJhbmltYXRlSWQiLCJjbGVhclRpbWVvdXQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJ1bmRlZmluZWQiLCJwcm9wcyIsInByb3AiLCJzdHlsZSIsImdldENvbG9yIiwiaWR4IiwiYm9yZGVyUmFkaXVzIiwiTWF0aCIsInJvdW5kIiwic2hhZG93cyIsInBhcnNlQm94U2hhZG93IiwiZGVncmVlcyIsImJhY2tncm91bmRMaW5lIiwiaGVpZ2h0IiwiYmFja2dyb3VuZCIsInRyYW5zZm9ybU9yaWdpbiIsImRlbGF5IiwibGluZSIsImJveFNoYWRvdyIsIm5vcm1hbGl6ZVNoYWRvdyIsImFwcGVuZENoaWxkIiwicmVnZXgiLCJfaSIsIl9hIiwic3BsaXQiLCJtYXRjaGVzIiwibWF0Y2giLCJ4IiwieSIsInhVbml0cyIsInlVbml0cyIsInB1c2giLCJwcmVmaXgiLCJlbmQiLCJub3JtYWxpemVkIiwic2hhZG93c18xIiwieHkiLCJjb252ZXJ0T2Zmc2V0Iiwiam9pbiIsInJhZGlhbnMiLCJQSSIsInNpbiIsImNvcyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsV0FBWSxRQUFRLEtBQUtBLFFBQWQsSUFBMkJDLE9BQU9DLE1BQWxDLElBQTRDLFVBQVNDLENBQVQsRUFBWTtBQUNuRSxTQUFLLElBQUlDLENBQUosRUFBT0MsSUFBSSxDQUFYLEVBQWNDLElBQUlDLFVBQVVDLE1BQWpDLEVBQXlDSCxJQUFJQyxDQUE3QyxFQUFnREQsR0FBaEQsRUFBcUQ7QUFDakRELFlBQUlHLFVBQVVGLENBQVYsQ0FBSjtBQUNBLGFBQUssSUFBSUksQ0FBVCxJQUFjTCxDQUFkO0FBQWlCLGdCQUFJSCxPQUFPUyxTQUFQLENBQWlCQyxjQUFqQixDQUFnQ0MsSUFBaEMsQ0FBcUNSLENBQXJDLEVBQXdDSyxDQUF4QyxDQUFKLEVBQ2JOLEVBQUVNLENBQUYsSUFBT0wsRUFBRUssQ0FBRixDQUFQO0FBREo7QUFFSDtBQUNELFdBQU9OLENBQVA7QUFDSCxDQVBEO0FBUUEsSUFBSVUsV0FBVztBQUNYQyxXQUFPLEVBREk7QUFFWE4sWUFBUSxDQUZHO0FBR1hPLFdBQU8sQ0FISTtBQUlYQyxZQUFRLEVBSkc7QUFLWEMsV0FBTyxHQUxJO0FBTVhDLGFBQVMsQ0FORTtBQU9YQyxXQUFPLE1BUEk7QUFRWEMsZUFBVyxhQVJBO0FBU1hDLGVBQVcsMkJBVEE7QUFVWEMsWUFBUSxDQVZHO0FBV1hDLGVBQVcsQ0FYQTtBQVlYQyxXQUFPLENBWkk7QUFhWEMsWUFBUSxHQWJHO0FBY1hDLGVBQVcsU0FkQTtBQWVYQyxTQUFLLEtBZk07QUFnQlhDLFVBQU0sS0FoQks7QUFpQlhDLFlBQVEscUJBakJHO0FBa0JYQyxjQUFVO0FBbEJDLENBQWY7QUFvQkEsSUFBSUMsVUFBVSxhQUFlLFlBQVk7QUFDckMsYUFBU0EsT0FBVCxDQUFpQkMsSUFBakIsRUFBdUI7QUFDbkIsWUFBSUEsU0FBUyxLQUFLLENBQWxCLEVBQXFCO0FBQUVBLG1CQUFPLEVBQVA7QUFBWTtBQUNuQyxhQUFLQSxJQUFMLEdBQVloQyxTQUFTLEVBQVQsRUFBYWEsUUFBYixFQUF1Qm1CLElBQXZCLENBQVo7QUFDSDtBQUNEOzs7OztBQUtBRCxZQUFRckIsU0FBUixDQUFrQnVCLElBQWxCLEdBQXlCLFVBQVVDLE1BQVYsRUFBa0I7QUFDdkMsYUFBS0MsSUFBTDtBQUNBLGFBQUtDLEVBQUwsR0FBVUMsU0FBU0MsYUFBVCxDQUF1QixLQUF2QixDQUFWO0FBQ0EsYUFBS0YsRUFBTCxDQUFRVixTQUFSLEdBQW9CLEtBQUtNLElBQUwsQ0FBVU4sU0FBOUI7QUFDQSxhQUFLVSxFQUFMLENBQVFHLFlBQVIsQ0FBcUIsTUFBckIsRUFBNkIsYUFBN0I7QUFDQUMsWUFBSSxLQUFLSixFQUFULEVBQWE7QUFDVE4sc0JBQVUsS0FBS0UsSUFBTCxDQUFVRixRQURYO0FBRVRmLG1CQUFPLENBRkU7QUFHVFUsb0JBQVEsS0FBS08sSUFBTCxDQUFVUCxNQUhUO0FBSVRHLGtCQUFNLEtBQUtJLElBQUwsQ0FBVUosSUFKUDtBQUtURCxpQkFBSyxLQUFLSyxJQUFMLENBQVVMLEdBTE47QUFNVGMsdUJBQVcsV0FBVyxLQUFLVCxJQUFMLENBQVVmLEtBQXJCLEdBQTZCO0FBTi9CLFNBQWI7QUFRQSxZQUFJaUIsTUFBSixFQUFZO0FBQ1JBLG1CQUFPUSxZQUFQLENBQW9CLEtBQUtOLEVBQXpCLEVBQTZCRixPQUFPUyxVQUFQLElBQXFCLElBQWxEO0FBQ0g7QUFDREMsa0JBQVUsS0FBS1IsRUFBZixFQUFtQixLQUFLSixJQUF4QjtBQUNBLGVBQU8sSUFBUDtBQUNILEtBbEJEO0FBbUJBOzs7O0FBSUFELFlBQVFyQixTQUFSLENBQWtCeUIsSUFBbEIsR0FBeUIsWUFBWTtBQUNqQyxZQUFJLEtBQUtDLEVBQVQsRUFBYTtBQUNULGdCQUFJLE9BQU9TLHFCQUFQLEtBQWlDLFdBQXJDLEVBQWtEO0FBQzlDQyxxQ0FBcUIsS0FBS0MsU0FBMUI7QUFDSCxhQUZELE1BR0s7QUFDREMsNkJBQWEsS0FBS0QsU0FBbEI7QUFDSDtBQUNELGdCQUFJLEtBQUtYLEVBQUwsQ0FBUWEsVUFBWixFQUF3QjtBQUNwQixxQkFBS2IsRUFBTCxDQUFRYSxVQUFSLENBQW1CQyxXQUFuQixDQUErQixLQUFLZCxFQUFwQztBQUNIO0FBQ0QsaUJBQUtBLEVBQUwsR0FBVWUsU0FBVjtBQUNIO0FBQ0QsZUFBTyxJQUFQO0FBQ0gsS0FkRDtBQWVBLFdBQU9wQixPQUFQO0FBQ0gsQ0FqRDRCLEVBQTdCO0FBa0RBLFNBQVNBLE9BQVQ7QUFDQTs7O0FBR0EsU0FBU1MsR0FBVCxDQUFhSixFQUFiLEVBQWlCZ0IsS0FBakIsRUFBd0I7QUFDcEIsU0FBSyxJQUFJQyxJQUFULElBQWlCRCxLQUFqQixFQUF3QjtBQUNwQmhCLFdBQUdrQixLQUFILENBQVNELElBQVQsSUFBaUJELE1BQU1DLElBQU4sQ0FBakI7QUFDSDtBQUNELFdBQU9qQixFQUFQO0FBQ0g7QUFDRDs7O0FBR0EsU0FBU21CLFFBQVQsQ0FBa0JwQyxLQUFsQixFQUF5QnFDLEdBQXpCLEVBQThCO0FBQzFCLFdBQU8sT0FBT3JDLEtBQVAsSUFBZ0IsUUFBaEIsR0FBMkJBLEtBQTNCLEdBQW1DQSxNQUFNcUMsTUFBTXJDLE1BQU1YLE1BQWxCLENBQTFDO0FBQ0g7QUFDRDs7O0FBR0EsU0FBU29DLFNBQVQsQ0FBbUJSLEVBQW5CLEVBQXVCSixJQUF2QixFQUE2QjtBQUN6QixRQUFJeUIsZUFBZ0JDLEtBQUtDLEtBQUwsQ0FBVzNCLEtBQUtkLE9BQUwsR0FBZWMsS0FBS2pCLEtBQXBCLEdBQTRCLEdBQXZDLElBQThDLElBQS9DLEdBQXVELElBQTFFO0FBQ0EsUUFBSWMsU0FBUyxNQUFiO0FBQ0EsUUFBSUcsS0FBS0gsTUFBTCxLQUFnQixJQUFwQixFQUEwQjtBQUN0QkEsaUJBQVMsZ0JBQVQsQ0FEc0IsQ0FDSztBQUM5QixLQUZELE1BR0ssSUFBSSxPQUFPRyxLQUFLSCxNQUFaLEtBQXVCLFFBQTNCLEVBQXFDO0FBQ3RDQSxpQkFBU0csS0FBS0gsTUFBZDtBQUNIO0FBQ0QsUUFBSStCLFVBQVVDLGVBQWVoQyxNQUFmLENBQWQ7QUFDQSxTQUFLLElBQUl4QixJQUFJLENBQWIsRUFBZ0JBLElBQUkyQixLQUFLbEIsS0FBekIsRUFBZ0NULEdBQWhDLEVBQXFDO0FBQ2pDLFlBQUl5RCxVQUFVLENBQUMsRUFBRSxNQUFNOUIsS0FBS2xCLEtBQVgsR0FBbUJULENBQW5CLEdBQXVCMkIsS0FBS1YsTUFBOUIsQ0FBZjtBQUNBLFlBQUl5QyxpQkFBaUJ2QixJQUFJSCxTQUFTQyxhQUFULENBQXVCLEtBQXZCLENBQUosRUFBbUM7QUFDcERSLHNCQUFVLFVBRDBDO0FBRXBESCxpQkFBSyxDQUFDSyxLQUFLakIsS0FBTixHQUFjLENBQWQsR0FBa0IsSUFGNkI7QUFHcERBLG1CQUFRaUIsS0FBS3hCLE1BQUwsR0FBY3dCLEtBQUtqQixLQUFwQixHQUE2QixJQUhnQjtBQUlwRGlELG9CQUFRaEMsS0FBS2pCLEtBQUwsR0FBYSxJQUorQjtBQUtwRGtELHdCQUFZVixTQUFTdkIsS0FBS1osU0FBZCxFQUF5QmYsQ0FBekIsQ0FMd0M7QUFNcERvRCwwQkFBY0EsWUFOc0M7QUFPcERTLDZCQUFpQixNQVBtQztBQVFwRHpCLHVCQUFXLFlBQVlxQixPQUFaLEdBQXNCLGtCQUF0QixHQUEyQzlCLEtBQUtoQixNQUFoRCxHQUF5RDtBQVJoQixTQUFuQyxDQUFyQjtBQVVBLFlBQUltRCxRQUFROUQsSUFBSTJCLEtBQUtULFNBQVQsR0FBcUJTLEtBQUtsQixLQUExQixHQUFrQ2tCLEtBQUtSLEtBQW5EO0FBQ0EyQyxpQkFBUyxJQUFJbkMsS0FBS1IsS0FBbEIsQ0FiaUMsQ0FhUjtBQUN6QixZQUFJNEMsT0FBTzVCLElBQUlILFNBQVNDLGFBQVQsQ0FBdUIsS0FBdkIsQ0FBSixFQUFtQztBQUMxQ3ZCLG1CQUFPLE1BRG1DO0FBRTFDaUQsb0JBQVEsTUFGa0M7QUFHMUNDLHdCQUFZVixTQUFTdkIsS0FBS2IsS0FBZCxFQUFxQmQsQ0FBckIsQ0FIOEI7QUFJMUNvRCwwQkFBY0EsWUFKNEI7QUFLMUNZLHVCQUFXQyxnQkFBZ0JWLE9BQWhCLEVBQXlCRSxPQUF6QixDQUwrQjtBQU0xQ3pDLHVCQUFXLElBQUlXLEtBQUtSLEtBQVQsR0FBaUIsV0FBakIsR0FBK0IyQyxLQUEvQixHQUF1QyxhQUF2QyxHQUF1RG5DLEtBQUtYO0FBTjdCLFNBQW5DLENBQVg7QUFRQTBDLHVCQUFlUSxXQUFmLENBQTJCSCxJQUEzQjtBQUNBaEMsV0FBR21DLFdBQUgsQ0FBZVIsY0FBZjtBQUNIO0FBQ0o7QUFDRCxTQUFTRixjQUFULENBQXdCUSxTQUF4QixFQUFtQztBQUMvQixRQUFJRyxRQUFRLGlGQUFaO0FBQ0EsUUFBSVosVUFBVSxFQUFkO0FBQ0EsU0FBSyxJQUFJYSxLQUFLLENBQVQsRUFBWUMsS0FBS0wsVUFBVU0sS0FBVixDQUFnQixHQUFoQixDQUF0QixFQUE0Q0YsS0FBS0MsR0FBR2xFLE1BQXBELEVBQTREaUUsSUFBNUQsRUFBa0U7QUFDOUQsWUFBSTVDLFNBQVM2QyxHQUFHRCxFQUFILENBQWI7QUFDQSxZQUFJRyxVQUFVL0MsT0FBT2dELEtBQVAsQ0FBYUwsS0FBYixDQUFkO0FBQ0EsWUFBSUksWUFBWSxJQUFoQixFQUFzQjtBQUNsQixxQkFEa0IsQ0FDUjtBQUNiO0FBQ0QsWUFBSUUsSUFBSSxDQUFDRixRQUFRLENBQVIsQ0FBVDtBQUNBLFlBQUlHLElBQUksQ0FBQ0gsUUFBUSxDQUFSLENBQVQ7QUFDQSxZQUFJSSxTQUFTSixRQUFRLENBQVIsQ0FBYjtBQUNBLFlBQUlLLFNBQVNMLFFBQVEsQ0FBUixDQUFiO0FBQ0EsWUFBSUUsTUFBTSxDQUFOLElBQVcsQ0FBQ0UsTUFBaEIsRUFBd0I7QUFDcEJBLHFCQUFTQyxNQUFUO0FBQ0g7QUFDRCxZQUFJRixNQUFNLENBQU4sSUFBVyxDQUFDRSxNQUFoQixFQUF3QjtBQUNwQkEscUJBQVNELE1BQVQ7QUFDSDtBQUNELFlBQUlBLFdBQVdDLE1BQWYsRUFBdUI7QUFDbkIscUJBRG1CLENBQ1Q7QUFDYjtBQUNEckIsZ0JBQVFzQixJQUFSLENBQWE7QUFDVEMsb0JBQVFQLFFBQVEsQ0FBUixLQUFjLEVBRGI7QUFFVEUsZUFBR0EsQ0FGTTtBQUdUQyxlQUFHQSxDQUhNO0FBSVRDLG9CQUFRQSxNQUpDO0FBS1RDLG9CQUFRQSxNQUxDO0FBTVRHLGlCQUFLUixRQUFRLENBQVI7QUFOSSxTQUFiO0FBUUg7QUFDRCxXQUFPaEIsT0FBUDtBQUNIO0FBQ0Q7OztBQUdBLFNBQVNVLGVBQVQsQ0FBeUJWLE9BQXpCLEVBQWtDRSxPQUFsQyxFQUEyQztBQUN2QyxRQUFJdUIsYUFBYSxFQUFqQjtBQUNBLFNBQUssSUFBSVosS0FBSyxDQUFULEVBQVlhLFlBQVkxQixPQUE3QixFQUFzQ2EsS0FBS2EsVUFBVTlFLE1BQXJELEVBQTZEaUUsSUFBN0QsRUFBbUU7QUFDL0QsWUFBSTVDLFNBQVN5RCxVQUFVYixFQUFWLENBQWI7QUFDQSxZQUFJYyxLQUFLQyxjQUFjM0QsT0FBT2lELENBQXJCLEVBQXdCakQsT0FBT2tELENBQS9CLEVBQWtDakIsT0FBbEMsQ0FBVDtBQUNBdUIsbUJBQVdILElBQVgsQ0FBZ0JyRCxPQUFPc0QsTUFBUCxHQUFnQkksR0FBRyxDQUFILENBQWhCLEdBQXdCMUQsT0FBT21ELE1BQS9CLEdBQXdDLEdBQXhDLEdBQThDTyxHQUFHLENBQUgsQ0FBOUMsR0FBc0QxRCxPQUFPb0QsTUFBN0QsR0FBc0VwRCxPQUFPdUQsR0FBN0Y7QUFDSDtBQUNELFdBQU9DLFdBQVdJLElBQVgsQ0FBZ0IsSUFBaEIsQ0FBUDtBQUNIO0FBQ0QsU0FBU0QsYUFBVCxDQUF1QlYsQ0FBdkIsRUFBMEJDLENBQTFCLEVBQTZCakIsT0FBN0IsRUFBc0M7QUFDbEMsUUFBSTRCLFVBQVU1QixVQUFVSixLQUFLaUMsRUFBZixHQUFvQixHQUFsQztBQUNBLFFBQUlDLE1BQU1sQyxLQUFLa0MsR0FBTCxDQUFTRixPQUFULENBQVY7QUFDQSxRQUFJRyxNQUFNbkMsS0FBS21DLEdBQUwsQ0FBU0gsT0FBVCxDQUFWO0FBQ0EsV0FBTyxDQUNIaEMsS0FBS0MsS0FBTCxDQUFXLENBQUNtQixJQUFJZSxHQUFKLEdBQVVkLElBQUlhLEdBQWYsSUFBc0IsSUFBakMsSUFBeUMsSUFEdEMsRUFFSGxDLEtBQUtDLEtBQUwsQ0FBVyxDQUFDLENBQUNtQixDQUFELEdBQUtjLEdBQUwsR0FBV2IsSUFBSWMsR0FBaEIsSUFBdUIsSUFBbEMsSUFBMEMsSUFGdkMsQ0FBUDtBQUlIIiwiZmlsZSI6InNwaW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHtcbiAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcbiAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKVxuICAgICAgICAgICAgdFtwXSA9IHNbcF07XG4gICAgfVxuICAgIHJldHVybiB0O1xufTtcbnZhciBkZWZhdWx0cyA9IHtcbiAgICBsaW5lczogMTIsXG4gICAgbGVuZ3RoOiA3LFxuICAgIHdpZHRoOiA1LFxuICAgIHJhZGl1czogMTAsXG4gICAgc2NhbGU6IDEuMCxcbiAgICBjb3JuZXJzOiAxLFxuICAgIGNvbG9yOiAnIzAwMCcsXG4gICAgZmFkZUNvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgIGFuaW1hdGlvbjogJ3NwaW5uZXItbGluZS1mYWRlLWRlZmF1bHQnLFxuICAgIHJvdGF0ZTogMCxcbiAgICBkaXJlY3Rpb246IDEsXG4gICAgc3BlZWQ6IDEsXG4gICAgekluZGV4OiAyZTksXG4gICAgY2xhc3NOYW1lOiAnc3Bpbm5lcicsXG4gICAgdG9wOiAnNTAlJyxcbiAgICBsZWZ0OiAnNTAlJyxcbiAgICBzaGFkb3c6ICcwIDAgMXB4IHRyYW5zcGFyZW50JyxcbiAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbn07XG52YXIgU3Bpbm5lciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTcGlubmVyKG9wdHMpIHtcbiAgICAgICAgaWYgKG9wdHMgPT09IHZvaWQgMCkgeyBvcHRzID0ge307IH1cbiAgICAgICAgdGhpcy5vcHRzID0gX19hc3NpZ24oe30sIGRlZmF1bHRzLCBvcHRzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyB0aGUgc3Bpbm5lciB0byB0aGUgZ2l2ZW4gdGFyZ2V0IGVsZW1lbnQuIElmIHRoaXMgaW5zdGFuY2UgaXMgYWxyZWFkeVxuICAgICAqIHNwaW5uaW5nLCBpdCBpcyBhdXRvbWF0aWNhbGx5IHJlbW92ZWQgZnJvbSBpdHMgcHJldmlvdXMgdGFyZ2V0IGJ5IGNhbGxpbmdcbiAgICAgKiBzdG9wKCkgaW50ZXJuYWxseS5cbiAgICAgKi9cbiAgICBTcGlubmVyLnByb3RvdHlwZS5zcGluID0gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgdGhpcy5lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLmVsLmNsYXNzTmFtZSA9IHRoaXMub3B0cy5jbGFzc05hbWU7XG4gICAgICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdyb2xlJywgJ3Byb2dyZXNzYmFyJyk7XG4gICAgICAgIGNzcyh0aGlzLmVsLCB7XG4gICAgICAgICAgICBwb3NpdGlvbjogdGhpcy5vcHRzLnBvc2l0aW9uLFxuICAgICAgICAgICAgd2lkdGg6IDAsXG4gICAgICAgICAgICB6SW5kZXg6IHRoaXMub3B0cy56SW5kZXgsXG4gICAgICAgICAgICBsZWZ0OiB0aGlzLm9wdHMubGVmdCxcbiAgICAgICAgICAgIHRvcDogdGhpcy5vcHRzLnRvcCxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogXCJzY2FsZShcIiArIHRoaXMub3B0cy5zY2FsZSArIFwiKVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgICAgdGFyZ2V0Lmluc2VydEJlZm9yZSh0aGlzLmVsLCB0YXJnZXQuZmlyc3RDaGlsZCB8fCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgICBkcmF3TGluZXModGhpcy5lbCwgdGhpcy5vcHRzKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBTdG9wcyBhbmQgcmVtb3ZlcyB0aGUgU3Bpbm5lci5cbiAgICAgKiBTdG9wcGVkIHNwaW5uZXJzIG1heSBiZSByZXVzZWQgYnkgY2FsbGluZyBzcGluKCkgYWdhaW4uXG4gICAgICovXG4gICAgU3Bpbm5lci5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuZWwpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVxdWVzdEFuaW1hdGlvbkZyYW1lICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuYW5pbWF0ZUlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmFuaW1hdGVJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5lbC5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBTcGlubmVyO1xufSgpKTtcbmV4cG9ydCB7IFNwaW5uZXIgfTtcbi8qKlxuICogU2V0cyBtdWx0aXBsZSBzdHlsZSBwcm9wZXJ0aWVzIGF0IG9uY2UuXG4gKi9cbmZ1bmN0aW9uIGNzcyhlbCwgcHJvcHMpIHtcbiAgICBmb3IgKHZhciBwcm9wIGluIHByb3BzKSB7XG4gICAgICAgIGVsLnN0eWxlW3Byb3BdID0gcHJvcHNbcHJvcF07XG4gICAgfVxuICAgIHJldHVybiBlbDtcbn1cbi8qKlxuICogUmV0dXJucyB0aGUgbGluZSBjb2xvciBmcm9tIHRoZSBnaXZlbiBzdHJpbmcgb3IgYXJyYXkuXG4gKi9cbmZ1bmN0aW9uIGdldENvbG9yKGNvbG9yLCBpZHgpIHtcbiAgICByZXR1cm4gdHlwZW9mIGNvbG9yID09ICdzdHJpbmcnID8gY29sb3IgOiBjb2xvcltpZHggJSBjb2xvci5sZW5ndGhdO1xufVxuLyoqXG4gKiBJbnRlcm5hbCBtZXRob2QgdGhhdCBkcmF3cyB0aGUgaW5kaXZpZHVhbCBsaW5lcy5cbiAqL1xuZnVuY3Rpb24gZHJhd0xpbmVzKGVsLCBvcHRzKSB7XG4gICAgdmFyIGJvcmRlclJhZGl1cyA9IChNYXRoLnJvdW5kKG9wdHMuY29ybmVycyAqIG9wdHMud2lkdGggKiA1MDApIC8gMTAwMCkgKyAncHgnO1xuICAgIHZhciBzaGFkb3cgPSAnbm9uZSc7XG4gICAgaWYgKG9wdHMuc2hhZG93ID09PSB0cnVlKSB7XG4gICAgICAgIHNoYWRvdyA9ICcwIDJweCA0cHggIzAwMCc7IC8vIGRlZmF1bHQgc2hhZG93XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBvcHRzLnNoYWRvdyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgc2hhZG93ID0gb3B0cy5zaGFkb3c7XG4gICAgfVxuICAgIHZhciBzaGFkb3dzID0gcGFyc2VCb3hTaGFkb3coc2hhZG93KTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdHMubGluZXM7IGkrKykge1xuICAgICAgICB2YXIgZGVncmVlcyA9IH5+KDM2MCAvIG9wdHMubGluZXMgKiBpICsgb3B0cy5yb3RhdGUpO1xuICAgICAgICB2YXIgYmFja2dyb3VuZExpbmUgPSBjc3MoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksIHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgdG9wOiAtb3B0cy53aWR0aCAvIDIgKyBcInB4XCIsXG4gICAgICAgICAgICB3aWR0aDogKG9wdHMubGVuZ3RoICsgb3B0cy53aWR0aCkgKyAncHgnLFxuICAgICAgICAgICAgaGVpZ2h0OiBvcHRzLndpZHRoICsgJ3B4JyxcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IGdldENvbG9yKG9wdHMuZmFkZUNvbG9yLCBpKSxcbiAgICAgICAgICAgIGJvcmRlclJhZGl1czogYm9yZGVyUmFkaXVzLFxuICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiAnbGVmdCcsXG4gICAgICAgICAgICB0cmFuc2Zvcm06IFwicm90YXRlKFwiICsgZGVncmVlcyArIFwiZGVnKSB0cmFuc2xhdGVYKFwiICsgb3B0cy5yYWRpdXMgKyBcInB4KVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGRlbGF5ID0gaSAqIG9wdHMuZGlyZWN0aW9uIC8gb3B0cy5saW5lcyAvIG9wdHMuc3BlZWQ7XG4gICAgICAgIGRlbGF5IC09IDEgLyBvcHRzLnNwZWVkOyAvLyBzbyBpbml0aWFsIGFuaW1hdGlvbiBzdGF0ZSB3aWxsIGluY2x1ZGUgdHJhaWxcbiAgICAgICAgdmFyIGxpbmUgPSBjc3MoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksIHtcbiAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IGdldENvbG9yKG9wdHMuY29sb3IsIGkpLFxuICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiBib3JkZXJSYWRpdXMsXG4gICAgICAgICAgICBib3hTaGFkb3c6IG5vcm1hbGl6ZVNoYWRvdyhzaGFkb3dzLCBkZWdyZWVzKSxcbiAgICAgICAgICAgIGFuaW1hdGlvbjogMSAvIG9wdHMuc3BlZWQgKyBcInMgbGluZWFyIFwiICsgZGVsYXkgKyBcInMgaW5maW5pdGUgXCIgKyBvcHRzLmFuaW1hdGlvbixcbiAgICAgICAgfSk7XG4gICAgICAgIGJhY2tncm91bmRMaW5lLmFwcGVuZENoaWxkKGxpbmUpO1xuICAgICAgICBlbC5hcHBlbmRDaGlsZChiYWNrZ3JvdW5kTGluZSk7XG4gICAgfVxufVxuZnVuY3Rpb24gcGFyc2VCb3hTaGFkb3coYm94U2hhZG93KSB7XG4gICAgdmFyIHJlZ2V4ID0gL15cXHMqKFthLXpBLVpdK1xccyspPygtP1xcZCsoXFwuXFxkKyk/KShbYS16QS1aXSopXFxzKygtP1xcZCsoXFwuXFxkKyk/KShbYS16QS1aXSopKC4qKSQvO1xuICAgIHZhciBzaGFkb3dzID0gW107XG4gICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IGJveFNoYWRvdy5zcGxpdCgnLCcpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICB2YXIgc2hhZG93ID0gX2FbX2ldO1xuICAgICAgICB2YXIgbWF0Y2hlcyA9IHNoYWRvdy5tYXRjaChyZWdleCk7XG4gICAgICAgIGlmIChtYXRjaGVzID09PSBudWxsKSB7XG4gICAgICAgICAgICBjb250aW51ZTsgLy8gaW52YWxpZCBzeW50YXhcbiAgICAgICAgfVxuICAgICAgICB2YXIgeCA9ICttYXRjaGVzWzJdO1xuICAgICAgICB2YXIgeSA9ICttYXRjaGVzWzVdO1xuICAgICAgICB2YXIgeFVuaXRzID0gbWF0Y2hlc1s0XTtcbiAgICAgICAgdmFyIHlVbml0cyA9IG1hdGNoZXNbN107XG4gICAgICAgIGlmICh4ID09PSAwICYmICF4VW5pdHMpIHtcbiAgICAgICAgICAgIHhVbml0cyA9IHlVbml0cztcbiAgICAgICAgfVxuICAgICAgICBpZiAoeSA9PT0gMCAmJiAheVVuaXRzKSB7XG4gICAgICAgICAgICB5VW5pdHMgPSB4VW5pdHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHhVbml0cyAhPT0geVVuaXRzKSB7XG4gICAgICAgICAgICBjb250aW51ZTsgLy8gdW5pdHMgbXVzdCBtYXRjaCB0byB1c2UgYXMgY29vcmRpbmF0ZXNcbiAgICAgICAgfVxuICAgICAgICBzaGFkb3dzLnB1c2goe1xuICAgICAgICAgICAgcHJlZml4OiBtYXRjaGVzWzFdIHx8ICcnLFxuICAgICAgICAgICAgeDogeCxcbiAgICAgICAgICAgIHk6IHksXG4gICAgICAgICAgICB4VW5pdHM6IHhVbml0cyxcbiAgICAgICAgICAgIHlVbml0czogeVVuaXRzLFxuICAgICAgICAgICAgZW5kOiBtYXRjaGVzWzhdLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHNoYWRvd3M7XG59XG4vKipcbiAqIE1vZGlmeSBib3gtc2hhZG93IHgveSBvZmZzZXRzIHRvIGNvdW50ZXJhY3Qgcm90YXRpb25cbiAqL1xuZnVuY3Rpb24gbm9ybWFsaXplU2hhZG93KHNoYWRvd3MsIGRlZ3JlZXMpIHtcbiAgICB2YXIgbm9ybWFsaXplZCA9IFtdO1xuICAgIGZvciAodmFyIF9pID0gMCwgc2hhZG93c18xID0gc2hhZG93czsgX2kgPCBzaGFkb3dzXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIHZhciBzaGFkb3cgPSBzaGFkb3dzXzFbX2ldO1xuICAgICAgICB2YXIgeHkgPSBjb252ZXJ0T2Zmc2V0KHNoYWRvdy54LCBzaGFkb3cueSwgZGVncmVlcyk7XG4gICAgICAgIG5vcm1hbGl6ZWQucHVzaChzaGFkb3cucHJlZml4ICsgeHlbMF0gKyBzaGFkb3cueFVuaXRzICsgJyAnICsgeHlbMV0gKyBzaGFkb3cueVVuaXRzICsgc2hhZG93LmVuZCk7XG4gICAgfVxuICAgIHJldHVybiBub3JtYWxpemVkLmpvaW4oJywgJyk7XG59XG5mdW5jdGlvbiBjb252ZXJ0T2Zmc2V0KHgsIHksIGRlZ3JlZXMpIHtcbiAgICB2YXIgcmFkaWFucyA9IGRlZ3JlZXMgKiBNYXRoLlBJIC8gMTgwO1xuICAgIHZhciBzaW4gPSBNYXRoLnNpbihyYWRpYW5zKTtcbiAgICB2YXIgY29zID0gTWF0aC5jb3MocmFkaWFucyk7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgTWF0aC5yb3VuZCgoeCAqIGNvcyArIHkgKiBzaW4pICogMTAwMCkgLyAxMDAwLFxuICAgICAgICBNYXRoLnJvdW5kKCgteCAqIHNpbiArIHkgKiBjb3MpICogMTAwMCkgLyAxMDAwLFxuICAgIF07XG59XG4iXX0=